<div
    class="sm:absolute sm:inset-0 flex flex-col flex-auto min-w-0 overflow-auto bg-card dark:bg-transparent"
>
    <ng-container *ngIf="item$ | async as item" [formGroup]="form">
        <ng-container *ngIf="categories$ | async as cate">
            <!-- Header -->
            <div
                class="relative flex flex-col flex-0 pt-8 pb-2 px-6 md:px-8 border-b"
            >
                <!-- Loader -->
                <div class="absolute inset-x-0 bottom-0" *ngIf="isLoading">
                    <mat-progress-bar
                        [mode]="'indeterminate'"
                    ></mat-progress-bar>
                </div>
                <div
                    class="flex flex-row cursor-pointer w-fit"
                    routerLink="../"
                >
                    <mat-icon
                        [svgIcon]="'heroicons_solid:arrow-left'"
                    ></mat-icon>
                    <div class="text-2xl font-extrabold tracking-tight ml-4">
                        Quay lại
                    </div>
                </div>
                <div class="mt-8 text-3xl font-extrabold tracking-tight">
                    {{item.id ? 'Gói dịch vụ ' + item.name : 'Tạo gói dịch vụ'}}
                </div>

                <div class="mt-8 grid grid-cols-1 md:grid-cols-2">
                    <div class="flex flex-col items-center">
                        <div
                            class="w-2/3 h-80 max-w-2/3 max-h-80 border rounded overflow-hidden"
                        >
                            <ng-container *ngIf="tempImageUrl; else noImage">
                                <img
                                    class="w-full h-full object-cover"
                                    [src]="tempImageUrl"
                                />
                            </ng-container>
                            <ng-template #noImage>
                                <span
                                    class="flex justify-center items-center min-h-20 text-lg font-semibold"
                                    >NO IMAGE</span
                                >
                            </ng-template>
                        </div>
                        <div class="flex w-full justify-center pt-4">
                            <button
                                *ngIf="tempImageUrl !== null"
                                mat-flat-button
                                [color]="'primary'"
                                (click)="clearImage()"
                            >
                                Xóa
                            </button>
                            <button
                                *ngIf="tempImageUrl === null"
                                mat-flat-button
                                [color]="'primary'"
                                (click)="fileInput.click()"
                            >
                                Upload
                            </button>
                        </div>
                        <input
                            type="file"
                            #fileInput
                            style="display: none"
                            (change)="uploadImage($event)"
                            accept="image/*"
                        />
                    </div>
                    <div class="flex flex-col">
                        <mat-form-field class="w-full">
                            <mat-label>Tên gói dịch vụ</mat-label>
                            <input matInput [formControlName]="'name'" />
                            <mat-error
                                *ngIf="form.get('name').hasError('required')"
                            >
                                Tên gói dịch vụ không được để trống
                            </mat-error>
                        </mat-form-field>

                        <div class="flex flex-row">
                            <mat-form-field class="w-full pr-2">
                                <mat-label>Tổng giá</mat-label>
                                <input
                                    matInput
                                    readonly

                                    [value]="initPrice | number : '1.0-0'"
                                />
<!--                                <mat-error-->
<!--                                    *ngIf="-->
<!--                                        form-->
<!--                                            .get('totalAmount')-->
<!--                                            .hasError('required')-->
<!--                                    "-->
<!--                                >-->
<!--                                    Tổng giá không được để trống-->
<!--                                </mat-error>-->
                            </mat-form-field>

                            <mat-form-field class="w-full pr-2">
                                <mat-label>% giảm</mat-label>
                                <input
                                    matInput
                                    type="number"
                                    [formControlName]="'discountValueCombo'"
                                />
                                <mat-error
                                    *ngIf="
                                        form
                                            .get('discountValueCombo')
                                            .hasError('max')
                                    "
                                >
                                    % giảm không được quá 100%
                                </mat-error>
                            </mat-form-field>

                            <mat-form-field class="w-full">
                                <mat-label>Giá giảm</mat-label>
                                <input
                                    matInput
                                    readonly
                                    [value]="initPrice - (initPrice * form.get('discountValueCombo').value / 100)  | number : '1.0-0'"
                                />
                            </mat-form-field>
                        </div>

                        <mat-form-field class="w-full">
                            <mat-label>Mô tả</mat-label>
                            <textarea
                                matInput
                                [rows]="3"
                                [formControlName]="'description'"
                            ></textarea>
                            <mat-error
                                *ngIf="
                                    form
                                        .get('description')
                                        .hasError('maxlength')
                                "
                            >
                                Mô tả không được quá 300 ký tự
                            </mat-error>
                        </mat-form-field>

                        <div class="flex flex-row justify-between" *ngIf="item.id">
                            <div class="flex flex-row mb-4 font-medium">
                                <div>Đánh giá</div>
                                <div class="flex flex-row ml-4">
                                    <span
                                        *ngFor="
                                            let n of numSequence(
                                                MAX_RATING -
                                                    Math.round(item.rating)
                                            )
                                        "
                                    >
                                        <mat-icon
                                            class="icon-size-5 text-[#E8E8E8]"
                                            matPrefix
                                            [svgIcon]="'heroicons_solid:star'"
                                        >
                                        </mat-icon>
                                    </span>
                                    <span
                                        *ngFor="
                                            let n of numSequence(
                                                Math.round(item.rating)
                                            )
                                        "
                                    >
                                        <mat-icon
                                            class="icon-size-5 text-[#FABF35]"
                                            matPrefix
                                            [svgIcon]="'heroicons_solid:star'"
                                        >
                                        </mat-icon>
                                    </span>
                                </div>
                            </div>

                            <div class="flex flex-row truncate">
                                <div class="font-medium mr-4">Trạng thái</div>
<!--                                <mat-slide-toggle-->
<!--                                    class="ml-2"-->
<!--                                    [color]="'primary'"-->
<!--                                    [formControlName]="'status'"-->
<!--                                    (change)="_data.type === 'owner' || !cate.id ? changeStatusOwner($event) : changeStatusPartner($event)"-->
<!--                                    #status>-->
<!--                                </mat-slide-toggle>-->
                                <ng-container
                                    *ngIf="item.status === 'Active'"
                                    class="flex flex-col justify-center content-center"
                                >
                                    <mat-icon
                                        class="text-green-400 icon-size-5"
                                        [svgIcon]="'heroicons_solid:check'"
                                    >
                                    </mat-icon>
                                    <span class="text-green-400"
                                        >Đang hoạt động</span
                                    >
                                </ng-container>
                                <ng-container *ngIf="item.status !== 'Active'">
                                    <mat-icon
                                        class="text-gray-400 icon-size-5"
                                        [svgIcon]="'heroicons_solid:x'"
                                    ></mat-icon>
                                    <span class="text-gray-400"
                                        >Ngưng hoạt động</span
                                    >
                                </ng-container>
                            </div>
                        </div>
                        <div
                            class="flex items-center mr-4 mt-4 justify-center pb-2"
                            *ngIf="flashMessage"
                        >
                            <ng-container *ngIf="flashMessage === 'success'">
                                <mat-icon
                                    class="text-green-500"
                                    [svgIcon]="'heroicons_outline:check'"
                                ></mat-icon>
                                <span class="ml-2">Thành công</span>
                            </ng-container>
                            <ng-container *ngIf="flashMessage === 'error'">
                                <mat-icon
                                    class="text-red-500"
                                    [svgIcon]="'heroicons_outline:x'"
                                ></mat-icon>
                                <span class="ml-2"
                                    >Có lỗi xảy ra, vui lòng thử lại!</span
                                >
                            </ng-container>
                        </div>
                        <div class="flex justify-center">
                            <ng-container *ngIf="item.id">
                                <button
                                    class="mr-4"
                                    mat-raised-button
                                    color="primary"
                                    (click)="update(item.id)">
                                    Cập nhật
                                </button>
                                <button
                                    *ngIf="item.status === 'Active'"
                                    mat-raised-button
                                    color="warn"
                                    (click)="changeStatus(item.id, 'InActive', 'ngưng hoạt động')">
                                    Ngưng hoạt động
                                </button>
                                <button
                                    *ngIf="item.status !== 'Active'"
                                    mat-raised-button
                                    color="accent"
                                    (click)="changeStatus(item.id, 'Active', 'Tái hoạt động')">
                                    Tái hoạt động
                                </button>
                            </ng-container>
                            <button
                                *ngIf="!item.id"
                                mat-raised-button
                                color="primary"
                                (click)="create()"
                            >
                               Lưu
                            </button>
                        </div>
                    </div>
                </div>

                <div class="flex flex-row justify-between mt-4">
                    <div class="text-4xl font-extrabold tracking-tight">
                        Danh sách dịch vụ
                    </div>
                    <div class="flex shrink-0 items-center">
                        <button
                            class="ml-4"
                            mat-flat-button
                            [color]="'primary'"
                            (click)="
                                addService(form.get('comboServicesId').value)
                            "
                        >
                            <mat-icon
                                [svgIcon]="'heroicons_outline:plus'"
                            ></mat-icon>
                            <span class="ml-2 mr-1">Thêm dịch vụ</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Main -->
            <div class="flex flex-auto">
                <!-- Products list -->
                <div class="flex flex-col flex-auto">
                    <ng-container>
                        <ng-container>
                            <div class="grid">
                                <!-- Header -->
                                <div
                                    class="combo-detail-grid z-10 overflow-auto sticky top-0 grid gap-4 py-4 px-6 md:px-8 shadow text-md font-semibold text-secondary bg-gray-50 dark:bg-black dark:bg-opacity-5"
                                    matSort
                                    matSortDisableClear
                                >
                                    <div class="">Mã dịch vụ</div>
                                    <div class="">Loại dịch vụ</div>
                                    <div class="">Tên dịch vụ</div>
                                    <div class="">Giá cho thuê</div>
                                    <div>Chi tiết</div>
                                </div>

                                <!-- Rows -->
                                <ng-container
                                    *ngIf="
                                        form.get('comboServicesId')
                                            .value as comboServices1
                                    "
                                >
                                    <ng-container
                                        *ngFor="
                                            let comboServiceId of form.get(
                                                'comboServicesId'
                                            ).value;
                                            trackBy: trackByFn
                                        "
                                    >
                                        <ng-container
                                            *ngIf="
                                                getService(
                                                    comboServiceId
                                                ) as services1
                                            "
                                        >
                                            <div
                                                class="combo-detail-grid grid items-center gap-4 py-3 px-6 md:px-8 border-b"
                                            >
                                                <div class="truncate">
                                                    {{ services1.code }}
                                                </div>
                                                <div class="truncate">
                                                    {{
                                                        services1.category?.name
                                                    }}
                                                </div>
                                                <div class="truncate">
                                                    {{ services1.name }}
                                                </div>

                                                <div class="truncate">
                                                    {{
                                                        services1.currentPrices
                                                            ?.price
                                                            | number : "1.0-0"
                                                    }}
                                                    VNĐ
                                                </div>

                                                <div class="flex flex-row">
                                                    <button
                                                        class="min-w-10 min-h-7 h-7 px-2 leading-6 mr-2"
                                                        mat-stroked-button
                                                        (click)="
                                                            viewDetailService(
                                                                services1
                                                            )
                                                        "
                                                    >
                                                        <mat-icon
                                                            class="icon-size-5"
                                                            [svgIcon]="
                                                                'heroicons_outline:pencil-alt'
                                                            "
                                                        ></mat-icon>
                                                    </button>
                                                    <button
                                                        class="min-w-10 min-h-7 h-7 px-2 leading-6"
                                                        mat-stroked-button
                                                        [color]="'warn'"
                                                        (click)="
                                                            removeService(
                                                                comboServiceId
                                                            )
                                                        "
                                                    >
                                                        <mat-icon
                                                            class="icon-size-5"
                                                            [svgIcon]="
                                                                'heroicons_solid:trash'
                                                            "
                                                        ></mat-icon>
                                                    </button>
                                                </div>
                                            </div>
                                            <!--                                </ng-container>-->
                                            <!--                            </ng-container>-->
                                            <!--                        </div>-->

                                            <!--                        <mat-paginator-->
                                            <!--                            class="sm:absolute sm:inset-x-0 sm:bottom-0 border-b sm:border-t sm:border-b-0 z-10 bg-gray-50 dark:bg-transparent"-->
                                            <!--                            [ngClass]="{'pointer-events-none': isLoading}"-->
                                            <!--                            [length]="pagination.length"-->
                                            <!--                            [pageIndex]="pagination.page"-->
                                            <!--                            [pageSize]="pagination.size"-->
                                            <!--                            [pageSizeOptions]="[5, 10, 25, 100]"-->
                                            <!--                            [showFirstLastButtons]="true">-->
                                            <!--                        </mat-paginator>-->
                                        </ng-container>
                                    </ng-container>
                                </ng-container>
                            </div>
                        </ng-container>
                    </ng-container>
                </div>
            </div>
        </ng-container>
    </ng-container>
</div>

<ng-template #noProducts>
    <div
        class="p-8 sm:p-16 border-t text-4xl font-semibold tracking-tight text-center"
    >
        Không có dịch vụ đặt!
    </div>
</ng-template>
